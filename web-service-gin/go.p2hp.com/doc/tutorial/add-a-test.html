<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
<head>



  
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="theme-color" content="#00add8">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Material+Icons">
<link rel="stylesheet" href="../../css/styles.css">

  
  
  
<script src="../../go.dev/js/site.js"></script>
<meta name="og:url" content="https://go.dev/doc/tutorial/add-a-test">
<meta name="og:title" content="添加测试 - The Go Programming Language">
<title>添加测试 - Go中文网 Go语言中文网 golang</title>

 
<meta name="og:description" content="Go中文网 Go语言中文网 golang ;Go 是一种开源编程语言，可以轻松构建简单、可靠和高效的软件">
 
<meta name="description" content="Go中文网 Go语言中文网 golang ;Go 是一种开源编程语言，可以轻松构建简单、可靠和高效的软件.">

 
<meta name="og:image" content="https://go.dev/doc/gopher/gopher5logo.jpg">
<meta name="twitter:image" content="https://go.dev/doc/gopher/gopherbelly300.jpg">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@golang">
<script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4638549725433695" crossorigin="anonymous"></script><script src="https://www.p2hp.com/tj.js"></script></head>
<body class="Site">
  

  


<header class="Site-header js-siteHeader">
  <div class="Header Header--dark">
    <nav class="Header-nav">
      <a href="https://go.p2hp.com/" title="Go中文网">
        <img
          class="js-headerLogo Header-logo"
          src="../../go.dev/images/go-logo-white.svg"
          alt="Go">
      </a>
      <div class="Header-rightContent">
        <ul class="Header-menu">
          <li class="Header-menuItem ">
            <a href="https://go.p2hp.com/solutions/" target="">为什么用Go</a>
          </li>
          <li class="Header-menuItem ">
            <a href="https://go.p2hp.com/learn/" target="">快速开始</a>
          </li>
          <li class="Header-menuItem  Header-menuItem--active">
            <a href="../index.html" target="">文档</a>
          </li>
          <li class="Header-menuItem ">
            <a href="https://pkg.go.dev" target="_blank">包</a>
          </li>
          <li class="Header-menuItem ">
            <a href="https://go.p2hp.com/play/" target="">在线运行</a>
          </li>
          <li class="Header-menuItem ">
            <a href="https://go.p2hp.com/blog/" target="">博客</a>
          </li>
        </ul>
        <button class="Header-navOpen js-headerMenuButton Header-navOpen--white" aria-label="Open navigation.">
        </button>
      </div>
    </nav>
    
  </div>
</header>
<aside class="NavigationDrawer js-header">
  <nav class="NavigationDrawer-nav">
    <div class="NavigationDrawer-header">
      <a href="https://go.p2hp.com/">
        <img class="NavigationDrawer-logo" src="../../go.dev/images/go-logo-blue.svg" alt="Go.">
      </a>
    </div>
    <ul class="NavigationDrawer-list">
        <li class="NavigationDrawer-listItem ">
          <a href="https://go.p2hp.com/solutions/">为什么用Go</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href="https://go.p2hp.com/learn/">快速开始</a>
        </li>
        <li class="NavigationDrawer-listItem  NavigationDrawer-listItem--active">
          <a href="../index.html">文档</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href="https://pkg.go.dev">包</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href="https://go.p2hp.com/play/">在线运行</a>
        </li>
        <li class="NavigationDrawer-listItem ">
          <a href="https://go.p2hp.com/blog/">博客</a>
        </li>
    </ul>
  </nav>
</aside>
<div class="NavigationDrawer-scrim js-scrim" role="presentation"></div>
<main class="SiteContent SiteContent--default">
  


<article class="Doc Article">


<h1>添加测试</h1>






<div id="nav" class="TOC"></div>






<p>
  既然您已经将代码放到了一个稳定的地方（顺便说一句，做得很好），请添加一个测试。在开发期间测试您的代码可能会暴露在您进行更改时发现的错误。在本主题中，您将为<code>Hello</code>函数添加一个测试.
</p>

<aside class="Note">
  <strong>注意:</strong> 本主题是从<a href="https://go.p2hp.com/doc/tutorial/create-module.html">创建 Go 模块</a>开始的多部分教程的一部分.
</aside>

<p>
  Go 对单元测试的内置支持使您可以更轻松地进行测试。具体来说，使用命名约定、Go 的<code>testing</code>包和<code>go test</code>命令，您可以快速编写和执行测试.
</p>

<ol>
  <li>
    在 greetings 目录中，创建一个名为 greetings_test.go 的文件.

    <p>
      以 _test.go 结尾的文件名告诉<code>go test</code>命令该文件包含测试函数
    </p>
  </li>

  <li>
    在 greetings_test.go 中，粘贴以下代码并保存文件.

    <pre>
package greetings

import (
    "testing"
    "regexp"
)

// TestHelloName 用一个名字调用 greetings.Hello,
// 检查有效的返回值.
func TestHelloName(t *testing.T) {
    name := "Gladys"
    want := regexp.MustCompile(`\b`+name+`\b`)
    msg, err := Hello("Gladys")
    if !want.MatchString(msg) || err != nil {
        t.Fatalf(`Hello("Gladys") = %q, %v, want match for %#q, nil`, msg, err, want)
    }
}

// TestHelloEmpty 使用空字符串调用 greetings.Hello,
// 检查错误.
func TestHelloEmpty(t *testing.T) {
    msg, err := Hello("")
    if msg != "" || err == nil {
        t.Fatalf(`Hello("") = %q, %v, want "", error`, msg, err)
    }
}
</pre
    >

    <p>
      在此代码中，您:
    </p>

    <ul>
      <li>
        在与要测试的代码相同的包中实现测试函数.
      </li>
      <li>
        创建两个测试函数来测试<code>greetings.Hello</code>函数。测试函数名称的格式为<code>Test<em>Name</em></code>，其中 <em>Name</em> 表示有关特定测试的内容。此外，测试函数会获取指针指向<code>testing</code>包的<a href="https://pkg.go.dev/testing/#T"><code>testing.T</code>
          类型</a>作为参数。使用此参数的方法从测试中报告和记录.
      </li>
      <li>
        实现两个测试:

        <ul>
          <li>
            <code>TestHelloName</code>  调用 <code>Hello</code> 函数，传递一个<code>name</code>值，该函数应该能够使用该值返回有效的响应消息。如果调用返回错误或意外响应消息（不包含您传入的名称），则使用 <code>t</code> 参数的 <a href="https://pkg.go.dev/testing/#T.Fatalf">
              <code>Fatalf</code> 方法</a> 将消息打印到控制台并结束执行.
          </li>
          <li>
            <code>TestHelloEmpty</code> 使用空字符串调用 <code>Hello</code> 函数。此测试旨在确认错误处理是否正常工作。如果调用返回非空字符串或无错误，则使用 <code>t</code> 参数的 <code>Fatalf</code> 方法将消息打印到控制台并结束执行.
          </li>
        </ul>
      </li>
    </ul>
  </li>

  <li>
    在greetings目录下的命令行，运行 <a href="https://go.p2hp.com/cmd/go/#hdr-Test_packages"
    ><code>go test</code> 命令</a
  >执行测试.

    <p>
      <code>go test</code> 命令在测试文件（其名称以 _test.go 结尾）中执行测试函数（其名称以 <code>Test</code>开头）。您可以添加 <code>-v</code>  标志以获取列出所有测试及其结果的详细输出。
    </p>

    <p>
      测试应该通过.
    </p>

    <pre>
$ go test
PASS
ok      example.com/greetings   0.364s

$ go test -v
=== RUN   TestHelloName
--- PASS: TestHelloName (0.00s)
=== RUN   TestHelloEmpty
--- PASS: TestHelloEmpty (0.00s)
PASS
ok      example.com/greetings   0.372s
</pre
    >
  </li>

  <li>
    中断<code>greetings.Hello</code>函数以查看失败的测试.

    <p>
      <code>TestHelloName</code> 测试函数检查您指定为 <code>Hello</code> 函数参数的名称的返回值。若要查看失败的测试结果，请更改<code>greetings.Hello</code> 函数，以便它不再包含名称.
    </p>

    <p>
      在 greetings/greetings.go 中，粘贴以下代码来代替 <code>Hello</code> 函数。请注意，突出显示的行会更改函数返回的值，就好像 <code>name</code> 参数被意外删除一样.
    </p>

    <pre>
//  Hello 为指定的人返回问候语.
func Hello(name string) (string, error) {
    // 如果没有给出名字，返回一个带有消息的错误.
    if name == "" {
        return name, errors.New("empty name")
    }
    // 使用随机格式创建消息.
    <ins>// message := fmt.Sprintf(randomFormat(), name)
    message := fmt.Sprint(randomFormat())</ins>
    return message, nil
}
</pre>
  </li>

  <li>
    在greetings目录下的命令行，运行<code>go test</code>执行测试.

    <p>
      这一次，在没有 <code>-v</code> 标志的情况下运行 <code>go test</code>。输出将仅包括失败的测试的结果，这在您有很多测试时非常有用。<code>TestHelloName</code> 测试应该失败 -- <code>TestHelloEmpty</code>仍然通过.
    </p>

    <pre>
$ go test
--- FAIL: TestHelloName (0.00s)
    greetings_test.go:15: Hello("Gladys") = "Hail, %v! Well met!", &lt;nil>, want match for `\bGladys\b`, nil
FAIL
exit status 1
FAIL    example.com/greetings   0.182s
</pre
    >
  </li>
</ol>

<p>
  在下一个（也是最后一个）主题中，您将看到如何编译和安装代码以在本地运行它.
</p>

<p class="Navigation">
  <a class="Navigation-prev" href="greetings-multiple-people.html"
    >&lt; 为多人返回问候</a
  >
  <a class="Navigation-next" href="compile-install.html"
    >编译并安装应用程序 &gt;</a
  >
</p>


</article>



</main>
<footer class="Site-footer">
  <div class="Footer">
    <div class="Container">
      <div class="Footer-links">
          <div class="Footer-linkColumn">
            <a href="https://go.p2hp.com/solutions/"  target="" class="Footer-link Footer-link--primary">
              为什么用Go
            </a>
              <a href="https://go.p2hp.com/solutions/#use-cases"  target="" class="Footer-link">
                用例
              </a>
              <a href="https://go.p2hp.com/solutions/#case-studies"  target="" class="Footer-link">
                实例探究
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href="https://go.p2hp.com/learn/"  target="" class="Footer-link Footer-link--primary">
              快速开始
            </a>
              <a href="https://go.p2hp.com/play"  target="" class="Footer-link">
                在线运行
              </a>
              <a href="https://go.p2hp.com/tour/"  target="" class="Footer-link">
                边学边练
              </a>
              <a href="https://stackoverflow.com/questions/tagged/go?tab=Newest"  target="_blank" class="Footer-link">
                Stack Overflow
              </a>
              <a href="https://go.p2hp.com/help/"  target="" class="Footer-link">
                帮助
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href="https://pkg.go.dev"  target="_blank" class="Footer-link Footer-link--primary">
              包
            </a>
              <a href="https://go.p2hp.com/pkg/"  target="_blank" class="Footer-link">
                标准库
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href="https://go.p2hp.com/project"  target="" class="Footer-link Footer-link--primary">
              关于
            </a>
              <a href="https://go.p2hp.com/dl/"  target="" class="Footer-link">
                下载
              </a>
              <a href="https://go.p2hp.com/blog/"  target="" class="Footer-link">
                博客
              </a>
              <a href="https://github.com/golang/go/issues"  target="_blank" class="Footer-link">
                问题追踪
              </a>
              <a href="../devel/release.html"  target="" class="Footer-link">
                发行说明
              </a>
              <a href="https://go.p2hp.com/blog/go-brand"  target="_blank" class="Footer-link">
                品牌指南
              </a>
              <a href="https://go.p2hp.com/conduct"  target="" class="Footer-link">
                行为守则
              </a>
          </div>
          <div class="Footer-linkColumn">
            <a href="add-a-test.html"  target="_blank" class="Footer-link Footer-link--primary">
              连接
            </a>
              <a href="https://github.com/golang"  target="_blank" class="Footer-link">
                GitHub
              </a>
              <a href="https://invite.slack.golangbridge.org/"  target="_blank" class="Footer-link">
                Slack
              </a>
              <a href="https://www.meetup.com/pro/go"  target="_blank" class="Footer-link">
                Meetup
              </a>
              <a href="https://golangweekly.com/"  target="_blank" class="Footer-link">
                Golang Weekly
              </a>
          </div>
      </div>
    </div>
  </div>
  <div class="Footer">
    <div class="Container Container--fullBleed">
      <div class="Footer-bottom">
        <img class="Footer-gopher" src="../../go.dev/images/gophers/pilot-bust.svg" alt="The Go Gopher">
        <ul class="Footer-listRow">
          <li class="Footer-listItem">
            <a href="https://go.p2hp.com/copyright">版权</a>
          </li>
          <li class="Footer-listItem">
            <a href="https://go.p2hp.com/tos">服务条款</a>
          </li>
          <li class="Footer-listItem">
            <a href="https://www.p2hp.com/privacy-policy.php"
              target="_blank"
              rel="noopener">
              隐私政策
            </a>
            </li>
            <li class="Footer-listItem">
            <a href="https://go.p2hp.com/sitemap"
              target="_blank"
              rel="noopener">
              网站地图
            </a>
            </li>
          
          <li class="Footer-listItem">
            <a
              href="https://go.p2hp.com/lianxi"
              target="_blank"
              >
              联系本站
            </a>
          </li>
          <li class="Footer-listItem">
            
              <a href="https://go.p2hp.com">Go中文网</a>版权所有 © 2021-2023
             
          </li>
          <li class="Footer-listItem">
            
              由 Lenix 建立和翻译 <span style="color: #e27575;font-size: 14px;">❤</span>
             
          </li>
          <li class="Footer-listItem">
            
              请按Ctrl+D试试
             
          </li>
          <li class="Footer-listItem go-Footer-listItem">
            <button class="go-Button go-Button--text go-Footer-toggleTheme js-toggleTheme" aria-label="Toggle theme">
              <img
                data-value="auto"
                class="go-Icon go-Icon--inverted"
                height="24"
                width="24"
                src="../../go.dev/images/icons/brightness_6_gm_grey_24dp.svg"
                alt="System theme">
              <img
                data-value="dark"
                class="go-Icon go-Icon--inverted"
                height="24"
                width="24"
                src="../../go.dev/images/icons/brightness_2_gm_grey_24dp.svg"
                alt="Dark theme">
              <img
                data-value="light"
                class="go-Icon go-Icon--inverted"
                height="24"
                width="24"
                src="../../go.dev/images/icons/light_mode_gm_grey_24dp.svg"
                alt="Light theme">
            </button>
          </li>
        </ul>
        <a class="Footer-googleLogo" target="_blank" href="https://go.p2hp.com" rel="noopener">
          <img class="Footer-googleLogoImg" src="../../go.dev/images/go-white.png" alt="go中文网 logo">
        </a>
      </div>
    </div>
  </div>
  <script src="../../go.dev/js/jquery.js"></script>
  <script src="../../go.dev/js/carousels.js"></script>
  <script src="../../go.dev/js/searchBox.js"></script>
  <script src="../../go.dev/js/misc.js"></script>
  <script src="../../go.dev/js/hats.js"></script>
  <script src="../../go.dev/js/playground.js"></script>
  <script src="../../go.dev/js/godocs.js"></script>
</footer>
</body>
</html>














